# Azure Deployment Plan for visitor-tracker Project

## **Goal**
Deploy the Visitor Tracker application (Laravel backend + React frontend) to Azure using Azure Container Apps and AZD with Bicep infrastructure templates.

## **Project Information**
AppName: visitor-tracker
- **Technology Stack**: Laravel 12 (PHP) backend + React 19 (Vite) frontend
- **Application Type**: Visitor management system with check-in/check-out functionality
- **Database**: SQLite (file-based, no external database required)
- **Containerization**: Requires Dockerfile creation for both services
- **Dependencies**: None (SQLite is file-based)
- **Hosting Recommendation**: Azure Container Apps for scalable, serverless container hosting

## **Azure Resources Architecture**
```mermaid
graph TD
    A[Azure Container Registry] --> B[Backend Container App]
    A --> C[Frontend Container App]
    B --> D[Azure Log Analytics]
    C --> D
    B --> E[Application Insights]
    C --> E
```

Data flow:
- Frontend Container App serves the React application
- Backend Container App provides API endpoints for visitor management
- Both apps send logs to Azure Log Analytics and telemetry to Application Insights
- Container images are stored in Azure Container Registry

## **Recommended Azure Resources**

### Application visitor-tracker-backend
- Hosting Service Type: Azure Container Apps
- SKU: Consumption (serverless, pay-per-use)
- Configuration:
  - language: php
  - dockerFilePath: backend/Dockerfile
  - dockerContext: backend/
  - Environment Variables: ["APP_ENV=production", "APP_KEY", "APP_DEBUG=false"]
- Dependencies Resource: None (SQLite file-based)

### Application visitor-tracker-frontend
- Hosting Service Type: Azure Container Apps
- SKU: Consumption (serverless, pay-per-use)
- Configuration:
  - language: nodejs
  - dockerFilePath: frontend/Dockerfile
  - dockerContext: frontend/
  - Environment Variables: ["VITE_API_URL"]
- Dependencies Resource: None

### Recommended Supporting Services
- Application Insights: For monitoring and telemetry
- Log Analytics Workspace: For centralized logging from both container apps
- Container Registry: For storing container images

### Recommended Security Configurations
- User managed identity: Must be assigned to both container apps
- AcrPull role assignment: User managed identity must have AcrPull role (7f951dda-4ed3-4680-a7ca-43fe172d538d) assigned to the container registry

## **Execution Steps**
> **Below are the steps for Copilot to follow; ask Copilot to update or execute this plan.**

1. Prepare Application for Containerization:
    1. Create Dockerfile for Laravel backend
    2. Create Dockerfile for React frontend
    3. Update environment configurations for production

2. Provision Azure Infrastructure And Deploy the Application:
    1. Based on required Azure resources in plan, get the IaC rules from the tool `iac-rules-get`
    2. Generate IaC (bicep files) for required azure resources based on the plan
    3. Pre-check: use `get_errors` tool to check generated Bicep grammar errors. Fix the errors if exist
    4. Run the AZD command `azd up` to provision the resources and confirm each resource is created or already exists
    5. Check the deployment output to ensure the resources are provisioned successfully
    6. Check the application log with tool `azd-app-log-get` to ensure the services are running

3. Summary:
    1. Summarize the deployment result and save to `.azure/summary.copilotmd`. It should list all changes deployment files and brief description of each file. Then have a diagram showing the provisioned azure resource.